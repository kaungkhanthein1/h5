{"version":3,"file":"static/js/918.3a5c3dd2.chunk.js","mappings":"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","sources":["pages/Point/components/Toast.tsx","pages/Point/pages/ItemDetail.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\n\ninterface ToastProps {\n  message: string;\n  duration?: number;\n  onClose?: () => void;\n}\n\nconst Toast: React.FC<ToastProps> = ({ message, duration = 3000, onClose }) => {\n  const [visible, setVisible] = useState<boolean>(true);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setVisible(false);\n      if (onClose) onClose();\n    }, duration);\n\n    return () => clearTimeout(timer);\n  }, [duration, onClose]);\n\n  if (!visible) return null;\n\n  return (\n    <div className=\"fixed top-1/2 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded shadow-lg z-50\">\n      {message}\n    </div>\n  );\n};\n\nexport default Toast;\n\n\n","import { FC, useState, Fragment, useMemo, useEffect } from \"react\";\nimport { Dialog, Transition } from \"@headlessui/react\";\nimport { useNavigate, useParams, useLocation } from \"react-router-dom\";\nimport { DetailData, CustomForm } from \"../types/goods\";\nimport { useRequest, useSafeState } from \"ahooks\";\nimport { Head, Card, Alert } from \"../components\";\nimport { itemDetail, sendOrder } from \"../api\";\nimport numeral from \"numeral\";\nimport Toast from \"../components/Toast\";\nimport Skeleton, { SkeletonTheme } from \"react-loading-skeleton\";\nimport \"react-loading-skeleton/dist/skeleton.css\";\nimport \"./style.css\";\n\nexport const ItemDetail = () => {\n  const [err, setErr] = useState<boolean>(false);\n  const [showToast, setShowToast] = useState<boolean>(false);\n\n  const params = useParams();\n  const navigate = useNavigate();\n  let [isOpen, setIsOpen] = useState<boolean>(!true);\n  let [msg, setMsg] = useState<any>({\n    show: false,\n    msg: \"\",\n    navBtn: false,\n  });\n\n  // useEffect(() => {\n  //   setShowToast(true);\n  // }, []);\n\n  const [alertConfig, setAlert] = useState({\n    title: \"\",\n    cancel: \"取消兑换\",\n    ok: \"确认兑换\",\n  });\n\n  const { data, error, loading } = useRequest<any, any>(\n    () => {\n      if (!params?.id) {\n        return false;\n      }\n      return itemDetail(params.id);\n    },\n    {\n      refreshDeps: [params?.id ?? 0],\n      cacheKey: `cacheKey-${params?.id}`,\n    }\n  );\n\n  const res = useMemo<DetailData>(() => {\n    if (data?.data?.id) {\n      return data?.data;\n    }\n    return {};\n  }, [data]);\n\n  const handleBuy = () => {\n    // setErr(true);\n    // setShowToast(true);\n    const jf = numeral(res?.current_price ?? 0).format(\"0,0\");\n    setAlert({\n      ...alertConfig,\n      title: `确认使用 ${jf} 积分兑换该物品？`,\n    });\n    setIsOpen(true);\n  };\n\n  const update = (jf: any) => {\n    console.log(\"it is come\");\n    // @ts-ignore\n    // if (typeof JsBridge === \"undefined\") {\n    //   // @ts-ignore\n    //   dsBridge.call(\n    //     \"updateUserInfo\",\n    //     {\n    //       name: \"integral\",\n    //       value: jf,\n    //     },\n    //     (value: any) => {}\n    //   );\n    // } else {\n    //   // @ts-ignore\n    //   JsBridge?.updateUserInfo?.(\n    //     JSON.stringify({ name: \"integral\", value: res?.data?.jf })\n    //   );\n    // }\n  };\n\n  const handleOrder = async () => {\n    try {\n      if ((res?.custom_form?.length ?? 0) === 0) {\n        const order = await sendOrder(params.id, {\n          form_data: \"[]\",\n        });\n        console.log(order)\n        if (order?.data?.order_id) {\n          console.log(\"updating\",order)\n          update(order.data.surplus_integral);\n          return navigate(`/info/${order.data.order_id}`);\n        }\n      }\n      return navigate(`/shop/${params.id}`);\n    } catch (err) {\n      console.log(\"debug: errerrerr\", err);\n      setIsOpen(false);\n      setMsg({\n        show: true,\n        msg: err,\n        navBtn: true,\n        center: true,\n        btnText: err === \"你还没有登录，请先登录\" ? \"立即登陆\" : null,\n      });\n    }\n  };\n\n  return (\n    <div className=\"container min-h-screen bg-white/90\">\n      <Head />\n      <Alert\n        {...msg}\n        onClose={() => {\n          setMsg({ msg: \"\", show: false, navBtn: false });\n        }}\n      />\n      {showToast && (\n        <Toast\n          message=\"Some devices not support.\"\n          duration={2000}\n          onClose={() => setShowToast(false)}\n        />\n      )}\n      <Transition show={isOpen} as={Fragment}>\n        <Dialog open={true} onClose={() => setIsOpen(false)}>\n          <Transition.Child\n            as={Fragment}\n            enter=\"ease-out duration-300\"\n            enterFrom=\"opacity-0\"\n            enterTo=\"opacity-100\"\n            leave=\"ease-in duration-200\"\n            leaveFrom=\"opacity-100\"\n            leaveTo=\"opacity-0\"\n          >\n            <div className=\"z-20 fixed inset-0 bg-black/30\" />\n          </Transition.Child>\n\n          <Transition.Child\n            as={Fragment}\n            enter=\"ease-out duration-300\"\n            enterFrom=\"opacity-0 scale-95\"\n            enterTo=\"opacity-100 scale-100\"\n            leave=\"ease-in duration-200\"\n            leaveFrom=\"opacity-100 scale-100\"\n            leaveTo=\"opacity-0 scale-95\"\n          >\n            <div className=\"fixed z-30 inset-0 overflow-y-auto\">\n              <div className=\"flex min-h-full items-center justify-center p-4\">\n                <Dialog.Panel className=\"w-80 max-w-sm rounded bg-white p-6 flex gap-8 flex-col\">\n                  <Dialog.Title className=\"text-base font-medium\">\n                    {alertConfig.title}\n                  </Dialog.Title>\n                  <Dialog.Description className=\"flex gap-2\">\n                    <button\n                      className=\" text-sm py-3 w-full text-black font-medium rounded border border-black/10\"\n                      onClick={() => {\n                        setIsOpen(false);\n                        setErr(false);\n                      }}\n                    >\n                      {alertConfig.cancel}\n                    </button>\n                    <button\n                      className=\"bg-[#ff6a33] text-sm py-3 w-full text-white font-medium rounded\"\n                      onClick={handleOrder}\n                    >\n                      {alertConfig.ok}\n                    </button>\n                  </Dialog.Description>\n                </Dialog.Panel>\n              </div>\n            </div>\n          </Transition.Child>\n        </Dialog>\n      </Transition>\n\n      {loading ? (\n        <SkeletonTheme\n          direction=\"ltr\"\n          baseColor=\"#E1E1E1\"\n          highlightColor=\"#00000030\"\n        >\n          <div className=\"px-4\">\n            <Skeleton className=\"rounded-lg w-full h-[200px] xl:w-[600px]\" />\n          </div>\n        </SkeletonTheme>\n      ) : (\n        <div className=\"w-full px-4 my-2\">\n          <div className=\"w-full rounded-lg bg-white h-[200px] relative overflow-hidden p-2 \">\n            {res?.label ?? \"\" ? (\n              <div className=\"absolute bg-[#ff6a33] text-white text-[12px] right-0 top-0 rounded-bl-lg px-3 h-[21px] flex items-center font-semibold\">\n                {res.label}\n              </div>\n            ) : null}\n            <img\n              alt=\"\"\n              src={res?.image}\n              className=\"object-cover w-full h-full rounded\"\n            />\n          </div>\n        </div>\n      )}\n\n      {loading ? (\n        <SkeletonTheme\n          direction=\"ltr\"\n          baseColor=\"#E1E1E1\"\n          highlightColor=\"#00000030\"\n        >\n          <div className=\"flex flex-col py-5 gap-2 px-4 bg-white rounded-lg h-full\">\n            <Skeleton width={150} className=\"rounded-lg h-[40px]\" />\n            <Skeleton width={130} className=\"rounded-lg h-[40px]\" />\n            <Skeleton className=\"rounded-lg h-[150px]\" />\n          </div>\n        </SkeletonTheme>\n      ) : (\n        <div className=\"flex flex-col py-5 px-4 bg-white rounded-lg h-full\">\n          <p className=\"font-medium text-lg text-black mb-6\">\n            {res?.title ?? \"\"}\n          </p>\n          <div className=\"font-medium text-base text-black flex items-center gap-1 mb-4\">\n            <div className=\"w-[3px] h-[14px] rounded-full bg-[#ff6a33]\"></div>\n            商品详情\n          </div>\n\n          <div className=\"flex flex-col text-sm text-black/60 pb-[100px]\">\n            <div\n              dangerouslySetInnerHTML={{ __html: res?.introduction ?? \"\" }}\n            ></div>\n          </div>\n        </div>\n      )}\n\n      {err && (\n        <div className=\" absolute bottom-[20px]\">\n          <h1 className=\" text-xl text-red-700 font-bold\">\n            Some devices do not currently support this process.\n          </h1>\n        </div>\n      )}\n\n      <div className=\"jf-foot bg-white fixed w-full z-10 bottom-0 left-0 min-h-min px-4 py-2 py-4\">\n        <div className=\"flex pb-2 justify-between items-center\">\n          <div className=\"flex flex-col\">\n            {typeof res?.current_price === \"number\" && (\n              <span className=\"text-md text-[#ff6a33] font-semibold\">\n                {res?.require_coupon > 0 && `${res.require_coupon} 兑换劵 + `}\n                {numeral(res.current_price).format(\"0,0\")}&nbsp;积分\n              </span>\n            )}\n\n            {res?.original_price ?? 0 ? (\n              <span className=\"text-[12px] text-black/40 font-semibold line-through decoration-black/40\">\n                {numeral(res?.original_price ?? 0).format(\"0,0\")}&nbsp;积分\n              </span>\n            ) : null}\n          </div>\n          {(res?.stock ?? 0) > 0 ? (\n            <button\n              // onTouchStart={handleBuy}\n              onTouchEnd={handleBuy}\n              onClick={handleBuy}\n              className=\"bg-[#ff6a33] text-sm py-[14px] px-[72px] text-white font-medium rounded \"\n            >\n              立即兑换\n            </button>\n          ) : (\n            <p className=\"bg-[#bfbfbf] text-sm py-[14px] px-[72px] text-white font-medium rounded \">\n              已售罄\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ItemDetail;\n"],"names":["_ref","message","duration","onClose","visible","setVisible","useState","useEffect","timer","setTimeout","clearTimeout","_jsx","className","children","ItemDetail","_params$id","_res$label","_res$title","_res$introduction","_res$original_price","_res$original_price2","_res$stock","err","setErr","showToast","setShowToast","params","useParams","navigate","useNavigate","isOpen","setIsOpen","msg","setMsg","show","navBtn","alertConfig","setAlert","title","cancel","ok","data","error","loading","useRequest","id","itemDetail","refreshDeps","cacheKey","res","useMemo","_data$data","handleBuy","_res$current_price","jf","numeral","current_price","format","_jsxs","Head","Alert","Toast","Transition","as","Fragment","Dialog","open","Child","enter","enterFrom","enterTo","leave","leaveFrom","leaveTo","Panel","Title","Description","onClick","async","_res$custom_form$leng","_res$custom_form","custom_form","length","_order$data","order","sendOrder","form_data","order_id","surplus_integral","center","btnText","SkeletonTheme","direction","baseColor","highlightColor","Skeleton","label","alt","src","image","width","dangerouslySetInnerHTML","__html","introduction","require_coupon","original_price","stock","onTouchEnd"],"sourceRoot":""}