{"version":3,"file":"static/js/653.f9f024d4.chunk.js","mappings":"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","sources":["pages/Point/pages/Shop.tsx"],"sourcesContent":["import { FC, useEffect, useState, Fragment, useMemo, useRef } from \"react\";\nimport { useNavigate, useParams, useLocation } from \"react-router-dom\";\nimport { useRequest } from \"ahooks\";\nimport { Dialog, Transition } from \"@headlessui/react\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { Head, Card, Alert } from \"../components\";\nimport { itemDetail, sendOrder } from \"../api\";\nimport { DetailData, CustomForm } from \"../types/goods\";\nimport numeral from \"numeral\";\nimport \"./style.css\";\nimport { useGetUserQuery } from \"../../../pages/profile/services/profileApi\";\n\nexport const Shop = () => {\n  let [isOpen, setIsOpen] = useState<boolean>(!true);\n  const { data: userData, refetch } = useGetUserQuery(undefined);\n  const form = useRef(null);\n  const params = useParams();\n  const navigate = useNavigate();\n  let [msg, setMsg] = useState<any>({\n    show: false,\n    msg: \"\",\n    navBtn: false,\n  });\n  const { register, handleSubmit, control, watch } = useForm<any>();\n  const { fields, append } = useFieldArray({\n    control,\n    name: \"fieldArray\",\n  });\n  const watchFieldArray = watch(\"fieldArray\", { dependencies: [fields] });\n  const controlledFields = fields.map((field, index) => {\n    return {\n      ...field,\n      ...watchFieldArray[index],\n    };\n  });\n\n  const { data, error, loading } = useRequest<any, any>(\n    () => {\n      if (!params?.id) {\n        return false;\n      }\n      return itemDetail(params.id);\n    },\n    {\n      refreshDeps: [params?.id ?? 0],\n      cacheKey: `cacheKey-${params?.id}`,\n    }\n  );\n\n  useEffect(() => {\n    if (data?.data?.custom_form?.length ?? 0) {\n      data.data.custom_form.forEach((o: any) => {\n        append({\n          value: o.value,\n          ...o,\n        });\n      });\n    }\n  }, [data?.data?.custom_form?.length ?? 0]);\n\n  const res = useMemo<DetailData>(() => {\n    if (data?.data?.id) {\n      return data?.data;\n    }\n    return {};\n  }, [data]);\n\n  const onSubmit = async (data: any) => {\n    if ((res?.custom_form?.length ?? 0) === 0) {\n      return navigate(`/info/${params.id}`);\n    } else {\n      try {\n        const order = await sendOrder(params.id, {\n          form_data: JSON.stringify(data.fieldArray),\n        });\n        if (order?.data?.order_id) {\n          refetch()\n          return navigate(`/info/${order.data.order_id}`);\n        }\n      } catch (err) {\n        setIsOpen(false);\n        setMsg({\n          show: true,\n          msg: err,\n          navBtn: true,\n        });\n      }\n    }\n  };\n\n  const renderForm = (params: any, key: any) => {\n    // res.custom_form\n    if (params.type === \"number\") {\n      return (\n        <div className=\"w-full flex justify-between py-3\" key={key}>\n          <label htmlFor={`form-${params.name}`} className=\"text-base\">\n            {params.name}\n          </label>\n          <input\n            className=\"outline-none\"\n            name={`form-${params.name}`}\n            type=\"text\"\n            placeholder={params.placeholder}\n            maxLength={15}\n            required={params?.required ?? false}\n          />\n        </div>\n      );\n    }\n    if (1) {\n      return (\n        <div className=\"w-full flex justify-between py-3 \" key={key}>\n          <label htmlFor=\"id1\" className=\"text-base\">\n            收货邮箱\n          </label>\n          <textarea\n            className=\"outline-none border border-black/05 bg-[#FBFBFB] p-3 rounded\"\n            name=\"id1\"\n            placeholder=\"请填写您的收获邮箱，便于及时发货！(推荐使用QQ邮箱)\"\n          ></textarea>\n        </div>\n      );\n    }\n  };\n\n  return (\n    <div className=\"container min-h-screen bg-white/90\">\n      <Head title=\"商品详情\" />\n      <Alert\n        {...msg}\n        onClose={() => {\n          setMsg({ msg: \"\", show: false, navBtn: false });\n        }}\n      />\n\n      <Transition show={isOpen} as={Fragment}>\n        <Dialog open={true} onClose={() => setIsOpen(false)}>\n          <Transition.Child\n            as={Fragment}\n            enter=\"ease-out duration-300\"\n            enterFrom=\"opacity-0\"\n            enterTo=\"opacity-100\"\n            leave=\"ease-in duration-200\"\n            leaveFrom=\"opacity-100\"\n            leaveTo=\"opacity-0\"\n          >\n            <div className=\"z-20 fixed inset-0 bg-black/30\" />\n          </Transition.Child>\n\n          <Transition.Child\n            as={Fragment}\n            enter=\"ease-out duration-300\"\n            enterFrom=\"opacity-0 scale-95\"\n            enterTo=\"opacity-100 scale-100\"\n            leave=\"ease-in duration-200\"\n            leaveFrom=\"opacity-100 scale-100\"\n            leaveTo=\"opacity-0 scale-95\"\n          >\n            <div className=\"fixed z-30 inset-0 overflow-y-auto\">\n              <div className=\"flex min-h-full items-center justify-center p-4\">\n                <Dialog.Panel className=\"w-80 max-w-sm rounded bg-white p-6 flex gap-8 flex-col\">\n                  <Dialog.Title className=\"text-base font-medium\">\n                    确认使用 9320 积分兑换该物品？\n                  </Dialog.Title>\n                  <Dialog.Description className=\"flex gap-2\">\n                    <button className=\" text-sm py-3 w-full text-black font-medium rounded border border-black/10\">\n                      取消兑换\n                    </button>\n                    <button className=\"bg-[#ff6a33] text-sm py-3 w-full text-white font-medium rounded \">\n                      立即兑换\n                    </button>\n                  </Dialog.Description>\n                </Dialog.Panel>\n              </div>\n            </div>\n          </Transition.Child>\n        </Dialog>\n      </Transition>\n\n      <div className=\"w-full py-1 mb-2 bg-white\">\n        <div className=\"w-full px-4 py-3 flex gap-2\">\n          <div className=\"w-20 h-20 rounded overflow-hidden\">\n            <img\n              alt=\"\"\n              src={res?.image ?? \"\"}\n              className=\"object-contain w-full h-full\"\n            />\n          </div>\n          <div className=\"flex flex-col gap-2\">\n            <div className=\"flex gap-1 items-center\">\n              {res?.label ?? \"\" ? (\n                <span className=\"text-[12px] bg-[#ff6a33] font-semibold text-white px-2.5 rounded flex items-center h-5 min-w-fit\">\n                  {res.label}\n                </span>\n              ) : null}\n              <p className=\"font-medium text-black text-base max-w-[200px]\">\n                {res?.title ?? \"\"}\n              </p>\n            </div>\n            <div className=\"flex flex-col\">\n              <span className=\"text-lg text-[#ff6a33] font-semibold\">\n                {numeral(res?.current_price ?? 0).format(\"0,0\")}&nbsp;积分\n              </span>\n              {(res?.original_price ?? 0) &&\n              res?.current_price != res?.original_price ? (\n                <span className=\"text-[12px] text-black/40 font-semibold line-through decoration-black/40\">\n                  {numeral(res?.original_price ?? 0).format(\"0,0\")}&nbsp;积分\n                </span>\n              ) : null}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {(res?.custom_form?.length ?? 0) === 0 ? null : (\n        <div className=\"flex flex-col px-4 bg-white h-full\">\n          <form\n            onSubmit={handleSubmit(onSubmit)}\n            className=\"divide-y divide-black/05\"\n          >\n            {controlledFields.map((field, index) => {\n              return (\n                <div\n                  className={`w-full flex justify-between py-3 ${\n                    field.type === \"textarea\" ? \"flex-col gap-2\" : \"\"\n                  }`}\n                >\n                  <label htmlFor={`form-${field.name}`} className=\"text-base\">\n                    {field.name}\n                  </label>\n                  {field.type === \"number\" || field.type === \"text\" ? (\n                    <input\n                      {...register(`fieldArray.${index}.value` as const, {\n                        required: !!(field?.required ?? 0),\n                        value: field.value,\n                      })}\n                      className=\"outline-none\"\n                      type=\"text\"\n                      placeholder={field.placeholder}\n                    />\n                  ) : null}\n                  {field.type === \"textarea\" ? (\n                    <textarea\n                      {...register(`fieldArray.${index}.value` as const, {\n                        required: !!(field?.required ?? 0),\n                        value: field.value,\n                      })}\n                      className=\"outline-none border border-black/05 bg-[#FBFBFB] p-3 rounded\"\n                      placeholder={field.placeholder}\n                    ></textarea>\n                  ) : null}\n                </div>\n              );\n            })}\n\n            <div className=\"jf-foot bg-white fixed w-full z-10 bottom-0 left-0 min-h-min px-4 py-2\">\n              <div className=\"flex pb-2 justify-between items-center\">\n                <div className=\"flex flex-col\">\n                  <span className=\"text-lg text-[#ff6a33] font-semibold\">\n                    {numeral(res?.current_price ?? 0).format(\"0,0\")}&nbsp;积分\n                  </span>\n                  {(res?.original_price ?? 0) &&\n                  res?.current_price != res?.original_price ? (\n                    <span className=\"text-[12px] text-black/40 font-semibold line-through decoration-black/40\">\n                      {numeral(res?.original_price ?? 0).format(\"0,0\")}\n                      &nbsp;积分\n                    </span>\n                  ) : null}\n                </div>\n                {(res?.stock ?? 0) > 0 ? (\n                  <button\n                    type=\"submit\"\n                    className=\"bg-[#ff6a33] text-sm py-[14px] px-[72px] text-white font-medium rounded \"\n                  >\n                    立即兑换\n                  </button>\n                ) : (\n                  <button className=\"bg-[#bfbfbf] text-sm py-[14px] px-[72px] text-white font-medium rounded \">\n                    已售罄\n                  </button>\n                )}\n              </div>\n            </div>\n          </form>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Shop;\n"],"names":["Shop","_params$id","_data$data$custom_for3","_data$data2","_data$data2$custom_fo","_res$image","_res$label","_res$title","_res$current_price","_res$original_price","_res$original_price2","_res$custom_form$leng2","_res$custom_form2","_res$current_price2","_res$original_price3","_res$original_price4","_res$stock","isOpen","setIsOpen","useState","data","userData","refetch","useGetUserQuery","undefined","params","useRef","useParams","navigate","useNavigate","msg","setMsg","show","navBtn","register","handleSubmit","control","watch","useForm","fields","append","useFieldArray","name","watchFieldArray","dependencies","controlledFields","map","field","index","error","loading","useRequest","id","itemDetail","refreshDeps","cacheKey","useEffect","_data$data$custom_for","_data$data","_data$data$custom_for2","custom_form","length","forEach","o","value","res","useMemo","_data$data3","_jsxs","className","children","_jsx","Head","title","Alert","onClose","Transition","as","Fragment","Dialog","open","Child","enter","enterFrom","enterTo","leave","leaveFrom","leaveTo","Panel","Title","Description","alt","src","image","label","numeral","current_price","format","original_price","onSubmit","async","_res$custom_form$leng","_res$custom_form","_order$data","order","sendOrder","form_data","JSON","stringify","fieldArray","order_id","err","_field$required","_field$required2","type","htmlFor","required","placeholder","stock"],"sourceRoot":""}